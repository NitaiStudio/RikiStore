<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Riki Store</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Roboto', sans-serif; background: #f0f2f5; margin: 0; }
        #admin-login-screen { display: flex; justify-content: center; align-items: center; height: 100vh; }
        .login-box { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 300px; text-align: center; }
        #admin-dashboard { display: none; padding: 20px; }
        .header { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; }
        .tab { padding: 10px 20px; background: white; border-radius: 8px; cursor: pointer; border: 1px solid #ddd; white-space: nowrap; transition: background-color 0.3s; }
        .tab.active { background: #6200ea; color: white; border: none; }
        table { width: 100%; background: white; border-radius: 8px; border-collapse: collapse; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #f8f9fa; }
        .admin-form { background: white; padding: 20px; border-radius: 8px; max-width: 600px; margin: 20px auto; display: none; }
        input, select, textarea { width: 100%; padding: 10px; margin: 5px 0 15px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box;}
        button { padding: 10px 15px; background: #6200ea; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .btn-red { background: #c62828; }
        .btn-green { background: #2e7d32; }
        .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; color: white; text-transform: capitalize; }
        .bg-pending { background: #ff9800; }
        .bg-approved { background: #2e7d32; }
        .bg-rejected { background: #c62828; }
    </style>
</head>
<body>

<div id="admin-login-screen">
    <div class="login-box">
        <h2>Admin Panel</h2>
        <input type="email" id="adm_email" placeholder="Admin Email" value="nitai.grp00@gmail.com" readonly>
        <input type="password" id="adm_pass" placeholder="Password">
        <button onclick="adminLogin()" style="width:100%">Login</button>
        <p id="login-msg" style="color:red; font-size:12px; margin-top:10px;"></p>
    </div>
</div>

<div id="admin-dashboard">
    <div class="header">
        <h2>Dashboard</h2>
        <div>
            <button onclick="initAdmin()">Initialize Admin</button>
            <button class="btn-red" onclick="auth.signOut()">Logout</button>
        </div>
    </div>
    <div class="tabs">
        <div class="tab active" onclick="switchTab('orders', this)">Orders</div>
        <div class="tab" onclick="switchTab('products', this)">Products</div>
        <div class="tab" onclick="document.getElementById('addProductForm').style.display='block'">+ New Product</div>
    </div>
    <div id="addProductForm" class="admin-form">
        <h3>Add Product</h3>
        <input type="text" id="ap_name" placeholder="Name"><select id="ap_cat"><option>App</option><option>Game</option><option>Script</option><option>Source Code</option><option>UI</option></select><input type="number" id="ap_price" placeholder="Price (₹)"><textarea id="ap_full" placeholder="Full Description"></textarea><label>Cover Image</label><input type="file" id="ap_img" accept="image/*"><input type="text" id="ap_demo" placeholder="Demo URL"><button onclick="uploadProduct()">Publish</button><button class="btn-red" onclick="this.parentElement.style.display='none'">Cancel</button>
    </div>
    <div id="orders-view" style="overflow-x:auto;">
        <table id="orders-table"><thead><tr><th>User Info</th><th>Product</th><th>Proof</th><th>Status</th><th>Action</th></tr></thead><tbody></tbody></table>
    </div>
    <div id="products-view" style="display:none; overflow-x:auto;">
        <table id="products-table"><thead><tr><th>Name</th><th>Price</th><th>Status</th><th>Action</th></tr></thead><tbody></tbody></table>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script>
    const firebaseConfig = { apiKey: "AIzaSyCzLZKJoOmLFfGlwxQHx1GifUasxTDV2Uc", authDomain: "rikiapp-71c4a.firebaseapp.com", databaseURL: "https://rikiapp-71c4a-default-rtdb.firebaseio.com", projectId: "rikiapp-71c4a", appId: "1:822715620946:web:f4fdf78f0b0eafdb8a098b" };
    const IMGBB_API_KEY = "391f65851f9593bedc4225e619cb24e4";
    const ADMIN_EMAIL = "nitai.grp00@gmail.com";

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    auth.onAuthStateChanged(user => {
        if (user && user.email === ADMIN_EMAIL) {
            document.getElementById('admin-login-screen').style.display = 'none';
            document.getElementById('admin-dashboard').style.display = 'block';
            loadProducts(); loadOrders();
        } else {
            document.getElementById('admin-login-screen').style.display = 'flex';
            document.getElementById('admin-dashboard').style.display = 'none';
        }
    });

    function adminLogin() { auth.signInWithEmailAndPassword(ADMIN_EMAIL, document.getElementById('adm_pass').value).catch(e => document.getElementById('login-msg').innerText = e.message); }
    function initAdmin() { const user = auth.currentUser; if(user) db.ref('admins/' + user.uid).set({ email: user.email, role: 'super_admin' }).then(() => alert("Admin Initialized!")); }
    function switchTab(tab, el) { document.getElementById('products-view').style.display = tab === 'products' ? 'block' : 'none'; document.getElementById('orders-view').style.display = tab === 'orders' ? 'block' : 'none'; document.querySelectorAll('.tab').forEach(t => t.classList.remove('active')); el.classList.add('active'); }
    
    async function uploadProduct() {
        const name = document.getElementById('ap_name').value, price = document.getElementById('ap_price').value, file = document.getElementById('ap_img').files[0];
        if(!file || !name || !price) return alert("Fill all fields");
        const btn = event.target; btn.innerText = "Uploading..."; btn.disabled = true;
        const formData = new FormData(); formData.append("image", file);
        try {
            const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, { method: 'POST', body: formData });
            const data = await res.json();
            db.ref('products').push({ name, price, logo: data.data.url, category: document.getElementById('ap_cat').value, fullDesc: document.getElementById('ap_full').value, demoLink: document.getElementById('ap_demo').value, status: 'Active' }).then(() => {
                alert("Product Added"); document.getElementById('addProductForm').reset(); document.getElementById('addProductForm').style.display = 'none';
            });
        } catch(e) { alert("Upload Error"); }
        finally { btn.innerText = "Publish"; btn.disabled = false; }
    }

    function loadProducts() {
        db.ref('products').on('value', snap => {
            let html = "";
            snap.forEach(child => { const p = child.val(); html += `<tr><td>${p.name}</td><td>₹${p.price}</td><td>${p.status}</td><td><button class="btn-red" onclick="deleteProduct('${child.key}')">Delete</button></td></tr>`; });
            document.querySelector('#products-table tbody').innerHTML = html;
        });
    }
    function deleteProduct(key) { if(confirm("Delete product?")) db.ref('products/' + key).remove(); }
    
    function loadOrders() {
        db.ref('purchases').on('value', snap => {
            let html = "";
            snap.forEach(child => {
                const o = child.val(); let actions = '';
                if (o.status === 'pending') actions = `<button class="btn-green" onclick="approveOrder('${child.key}')">Approve</button><br><button class="btn-red" style="margin-top:5px;" onclick="rejectOrder('${child.key}')">Reject</button>`;
                else actions = 'Done';
                html = `<tr><td>${o.userName}<br><small>${o.email}</small></td><td>${o.productName}<br><small>₹${o.amount}</small></td><td><small>ID: ${o.trxId}</small><br><a href="${o.screenshot}" target="_blank" style="color:blue;">View Proof</a></td><td><span class="status-badge bg-${o.status}">${o.status}</span></td><td>${actions}</td></tr>` + html;
            });
            document.querySelector('#orders-table tbody').innerHTML = html;
        });
    }
    function approveOrder(key) { const link = prompt("Enter Download URL:"); if (link) db.ref('purchases/' + key).update({ status: 'approved', downloadLink: link }); }
    function rejectOrder(key) { if (confirm("Reject order?")) db.ref('purchases/' + key).update({ status: 'rejected' }); }
</script>
</body>
</html>
